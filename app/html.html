<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="color-scheme" content="dark">
  <title>Triad Quiz — Enhanced UI</title>
  <style>
    :root{
      --ink:#0b0e14;
      --blue:#1e40af;
      --blue-300:#3b82f6;
      --blue-200:#93c5fd;
      --blue-100:#dbeafe;
      --red:#dc2626;
      --red-300:#f87171;
      --red-200:#fecaca;
      --red-900:#21060c;
      --red-950:#130306;
      --ring:#1e40af66;
      --glass:#0b0e14cc;
      --shadow-b:#1e40af33;
      --shadow-r:#dc262633;
      --glow-b: 0 0 20px 0px #1e40af44;
      --glow-r: 0 0 20px 0px #dc262655;
      --bg-active: linear-gradient(135deg, #1e40af22, #dc262628);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--red-950); color:var(--blue-100);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
      overflow-x:hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .bg{
      position:fixed; inset:0; z-index:-2;
      background:
        radial-gradient(1000px 600px at 5% 10%, #1e40af2b 0%, transparent 60%),
        radial-gradient(1200px 800px at 95% 90%, #dc262622 0%, transparent 60%),
        repeating-linear-gradient(135deg, #1e40af08 0 1px, transparent 1px 10px),
        repeating-linear-gradient(45deg, #dc262608 0 1px, transparent 1px 12px),
        linear-gradient(180deg, var(--red-900), var(--red-950));
      animation: drift 30s linear infinite alternate;
      filter: saturate(1.1);
    }
    @keyframes drift{ from{transform:translate3d(0, -1%, 0) scale(1.02)} to{transform:translate3d(0, 1%, 0) scale(1.02)} }
    .wrap{ max-width: 980px; margin:0 auto; padding: clamp(16px, 3vw, 32px); }
    header.top{
      display:flex; flex-direction: column; gap:10px;
      padding:14px; border:1px solid var(--ring); border-radius:16px; background:#0b0e1490; backdrop-filter: blur(8px);
      box-shadow: 0 10px 40px -20px var(--shadow-b);
      margin-bottom: 24px;
    }
    .top-info { display: flex; align-items: center; justify-content: space-between; width:100%;}
    .brand{ display:flex; gap:12px; align-items:center; text-decoration:none; color:var(--blue-100); font-size:18px }
    .pill{ padding:6px 10px; border-radius:999px; background:var(--ink); border:1px solid var(--ring); color:var(--blue-200); font-size:11px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:100% }
    .bar{ height:6px; background:#00000055; border:1px solid var(--ring); border-radius:999px; overflow:hidden; box-shadow: inset 0 1px 3px 0 #00000044 }
    .bar>i{ display:block; height:100%; width:0%; background: linear-gradient(90deg, var(--blue-300), var(--blue-200)); transition: width .3s ease-out }
    .card{
      background: var(--glass); border:1px solid transparent;
      border-image: linear-gradient(160deg, var(--blue), var(--red)) 1;
      border-radius: 22px;
      box-shadow: 0 28px 80px -40px var(--shadow-b), 0 10px 50px -35px var(--shadow-r);
      padding: clamp(20px, 3vw, 32px);
    }
    .qtext{
      font-size: clamp(22px, 3vw, 28px); font-weight: 500;
      line-height:1.3; margin: 8px 0 24px;
      background: linear-gradient(180deg, #dbeafe, #93c5fd);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 1px 10px #1e40af22;
    }
    .options{ display:grid; grid-template-columns: 1fr; gap:12px; margin: 12px 0 8px }
    .opt{
      display:flex; align-items:center; gap:12px; width:100%;
      padding:16px; border-radius:14px; border:1px solid var(--ring); background:#0b0e1499;
      color: var(--blue-200); cursor:pointer; transition: transform .1s ease, border-color .2s ease, background .2s ease, box-shadow .2s ease;
      text-align:left; font-size: 16px;
    }
    .opt:hover{ transform: translateY(-2px); border-color:var(--blue-300); box-shadow: var(--glow-b); }
    .opt.active{
      background: var(--bg-active);
      color: var(--red-100); border-color:var(--red-300); box-shadow: var(--glow-r);
      transform: translateY(-1px);
    }
    .opt::before{
      content: ''; display:block; width:12px; height:12px; border-radius:50%;
      border: 2px solid var(--ring); transition: border-color .2s ease, background-color .2s ease;
      flex-shrink: 0;
    }
    .opt:hover::before{ border-color: var(--blue-300); }
    .opt.active::before{ background-color: var(--red); border-color: var(--red-300); }
    .nav{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top: 24px; }
    .btn{
      appearance:none; border:none; cursor:pointer; font-weight:600; font-size: 15px; letter-spacing:.3px;
      padding: 12px 18px; border-radius: 12px; transition: transform .15s ease, box-shadow .2s ease;
    }
    .btn.primary {
      color: white; background: linear-gradient(135deg, var(--red), var(--red-300));
      box-shadow: 0 12px 40px -18px var(--shadow-r);
    }
    .btn.secondary {
      color: var(--blue-200); background: #0b0e1499; border: 1px solid var(--ring);
    }
    .btn[disabled]{ opacity:.5; cursor:not-allowed; transform: none !important; }
    .btn:hover:not([disabled]){ transform: translateY(-2px) }
    .result-grid{ display:grid; grid-template-columns: 1fr; gap:12px; }
    .result-item{ border:1px solid var(--ring); border-radius:14px; padding:12px 16px; background:#0b0e1499; display:flex; align-items:center; justify-content:space-between; gap: 16px; color:var(--blue-200); font-size: 15px; }
    .result-item-q { flex-grow: 1; }
    .result-item-a { color: var(--red-200); font-weight: 500; white-space: nowrap; }
    .fingerprint{
      margin-top:24px; padding:16px; border:1px solid; border-image: linear-gradient(160deg, var(--red), var(--blue)) 1; border-radius:14px; background:#0b0e1499; color:var(--blue-100); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }
    #fingerprint{ word-break:break-all; margin-top:8px; font-size:14px; color: var(--red-200); }
    .foot{ display:flex; justify-content:center; gap:10px; align-items:center; margin-top:16px; color:var(--blue-200); font-size: 14px; opacity: 0.7; }
  </style>
</head>
<body>
  <div class="bg"></div>
  <div class="wrap">
    <header class="top">
        <div class="top-info">
            <a class="brand" href="#"><strong>Triad Quiz</strong></a>
            <div class="pill">21 Questions • Deterministic</div>
        </div>
        <div class="bar" aria-hidden="true"><i id="progress"></i></div>
    </header>

    <div class="card" id="quizCard">
      <div class="qtext" id="qText"></div>
      <div class="options" id="options"></div>
      <div class="nav">
        <button class="btn secondary" id="prevBtn">Previous</button>
      </div>
    </div>

    <div class="card" id="resultCard" style="display:none">
      <h2 class="qtext">Your Results</h2>
      <div class="result-grid" id="resultList"></div>
      <div class="fingerprint">
        <div><b>Answer Fingerprint (SHA-256)</b></div>
        <div id="fingerprint"></div>
      </div>
      <div class="nav">
        <button class="btn primary" id="restartBtn">Start Over</button>
        <div style="display:flex; gap:10px">
          <button class="btn secondary" id="copyBtn">Copy Fingerprint</button>
          <button class="btn secondary" id="exportBtn">Export JSON</button>
        </div>
      </div>
      <div class="foot">Palette: Ink • Deep Blue • Crimson Red</div>
    </div>
  </div>

  <script>
    const QUESTIONS = [
      {id:"Q01", text:"I prefer clear structure over improvisation."},
      {id:"Q02", text:"I make decisions quickly under pressure."},
      {id:"Q03", text:"I enjoy challenging assumptions."},
      {id:"Q04", text:"I naturally look for long-term patterns."},
      {id:"Q05", text:"I prioritize safety and preparedness."},
      {id:"Q06", text:"I speak up to coordinate people."},
      {id:"Q07", text:"I like building systems that scale."},
      {id:"Q08", text:"I find it easy to energize a room."},
      {id:"Q09", text:"I smooth conflicts through careful wording."},
      {id:"Q10", text:"I like shared effort over solo wins."},
      {id:"Q11", text:"I keep resources stocked and ready."},
      {id:"Q12", text:"I investigate root causes before acting."},
      {id:"Q13", text:"I adapt plans when new information appears."},
      {id:"Q14", text:"I draw firm boundaries to protect focus."},
      {id:"Q15", text:"I value fairness even if it slows things down."},
      {id:"Q16", text:"I experiment to learn what works."},
      {id:"Q17", text:"I prefer concise, direct communication."},
      {id:"Q18", text:"I return to baseline calmly after stress."},
      {id:"Q19", text:"I measure results and iterate."},
      {id:"Q20", text:"I seek mentors and offer mentorship."},
      {id:"Q21", text:"I track decisions and make them auditable."}
    ];
    const ANSWERS = ["Strongly Agree", "Agree", "Disagree", "Strongly Disagree"];
    const TOTAL = QUESTIONS.length;

    let index = 0;
    let picks = new Array(TOTAL).fill(null);

    const el = (id)=>document.getElementById(id);
    const qText  = el('qText');
    const optionsBox = el('options');
    const progress = el('progress');
    const prevBtn = el('prevBtn');

    const quizCard = el('quizCard');
    const resultCard = el('resultCard');
    const resultList = el('resultList');
    const fingerprintEl = el('fingerprint');

    function render(){
      const q = QUESTIONS[index];
      qText.textContent = q.text;
      optionsBox.innerHTML = "";
      ANSWERS.forEach((label, i)=>{
        const b = document.createElement('button');
        b.className = 'opt' + (picks[index] === i ? ' active' : '');
        b.textContent = label;
        b.onclick = ()=>select(i);
        optionsBox.appendChild(b);
      });
      prevBtn.disabled = index === 0;
      progress.style.width = ((picks.filter(v=>v!=null).length)/TOTAL*100).toFixed(1)+'%';
      localStorage.setItem('triad-quiz-state', JSON.stringify({index, picks}));
    }

    function select(i){
      picks[index] = i;
      render();
      setTimeout(()=> advance(), 150);
    }

    function advance(){
      if(index < TOTAL-1){
        index++;
        render();
      }else{
        showSummary();
      }
    }

    prevBtn.onclick = ()=>{ if(index>0){ index--; render(); } };

    window.addEventListener('keydown', (e)=>{
      if (document.activeElement.tagName === 'BUTTON' && e.key === 'Enter') return;
      if(e.key>='1' && e.key<='4'){ select(parseInt(e.key,10)-1); }
      else if(e.key==='ArrowLeft'){ prevBtn.click(); }
      else if(e.key==='ArrowRight' && picks[index] !== null){ advance(); }
    });

    (function restore(){
      try{
        const raw = localStorage.getItem('triad-quiz-state');
        if(raw){
          const s = JSON.parse(raw);
          if(Array.isArray(s.picks) && s.picks.length === TOTAL){
            picks = s.picks.map(v => (v===0||v===1||v===2||v===3)?v:null);
            index = Math.min(Math.max(0, s.index|0), TOTAL-1);
          }
        }
      }catch{}
    })();

    render();

    async function showSummary(){
      quizCard.style.display = 'none';
      resultCard.style.display = 'block';
      resultList.innerHTML = '';
      QUESTIONS.forEach((q, i)=>{
        const item = document.createElement('div');
        item.className = 'result-item';
        const choiceIdx = picks[i];
        item.innerHTML = `<div class="result-item-q"><b>${q.id}</b> — ${q.text}</div><div class="result-item-a">${choiceIdx!=null ? ANSWERS[choiceIdx] : '—'}</div>`;
        resultList.appendChild(item);
      });
      const fp = await computeFingerprint(QUESTIONS, picks);
      fingerprintEl.textContent = fp;
    }

    async function computeFingerprint(qs, choices){
      const input = qs.map((q, i)=>`${q.id}:${choices[i]}`).join('|');
      const enc = new TextEncoder().encode(input);
      const digest = await crypto.subtle.digest('SHA-256', enc);
      return [...new Uint8Array(digest)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    el('restartBtn').onclick = ()=>{
      localStorage.removeItem('triad-quiz-state');
      picks = new Array(TOTAL).fill(null);
      index = 0;
      resultCard.style.display = 'none';
      quizCard.style.display = 'block';
      render();
      window.scrollTo({top:0, behavior:'smooth'});
    };
    el('copyBtn').onclick = async ()=>{
      try{
        await navigator.clipboard.writeText(fingerprintEl.textContent.trim());
        el('copyBtn').textContent = 'Copied!';
        setTimeout(()=> el('copyBtn').textContent = 'Copy Fingerprint', 1200);
      }catch{
        el('copyBtn').textContent = 'Copy Failed';
        setTimeout(()=> el('copyBtn').textContent = 'Copy Fingerprint', 1200);
      }
    };
    el('exportBtn').onclick = ()=>{
      const payload = {
        version: 2,
        title: "Triad Quiz Results",
        questions: QUESTIONS.map(q=>({id:q.id, text:q.text})),
        answers: ANSWERS,
        picks: picks,
        fingerprint: fingerprintEl.textContent.trim()
      };
      const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `triad-quiz-results-${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    };
  </script>
</body>
</html>