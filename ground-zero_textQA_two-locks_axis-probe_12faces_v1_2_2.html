<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>GROUND ZERO — 12-Face Seeded Engine (Text Q/A • Two Locks + Axis Probe)</title>
<style>
  :root {
    --bg: #0b0f14;
    --panel: #0f172a;
    --ink: #e5e7eb;
    --muted: #9ca3af;
    --accent: #60a5fa;
    --accent2: #34d399;
    --danger: #ef4444;
    --warn: #f59e0b;
    --ok: #22c55e;
    --ring: rgba(96,165,250,0.35);
    --border: #1f2937;
  }
  * { box-sizing: border-box; }
  html, body { margin:0; padding:0; background:var(--bg); color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
  .wrap { max-width: 1200px; margin: 24px auto; padding: 0 16px; }
  .hdr { display:flex; align-items:center; gap:12px; }
  .badge { font-size:12px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; color:var(--muted); background:linear-gradient(180deg,#0b1220,#0a1320); }
  h1 { font-size:22px; margin:6px 0 2px; }
  .sub { color:var(--muted); font-size:13px; margin-bottom:12px; }
  .grid { display:grid; grid-template-columns: 1.1fr 0.9fr; gap:16px; }
  .card { background:linear-gradient(180deg, var(--panel), #0b1220); border:1px solid var(--border); border-radius:14px; padding:16px; }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  .grow { flex:1 1 auto; }
  .pill { background:#0b1220; border:1px solid var(--border); padding:6px 10px; border-radius:8px; font-size:12px; color:var(--muted); }
  .slot { min-width:120px; height:38px; border-radius:8px; background:#0b1220; border:1px dashed var(--border); display:grid; place-items:center; font-size:12px; color:var(--muted); padding:0 8px; }
  .slot.filled { border-style:solid; color:var(--ink); }
  .sep { height:1px; background:var(--border); margin:10px 0; opacity:0.7; }
  .qline { font-size:15px; color:var(--ink); margin-bottom:10px; font-weight:600; }
  .qmeta { color:var(--muted); font-size:12px; margin-bottom:6px; }
  .options { display:grid; gap:8px; }
  .btn { user-select:none; border:1px solid var(--border); background:#0c1526; padding:12px 10px; border-radius:10px; color:var(--ink); font-weight:600; text-align:left; cursor:pointer; outline:none; line-height:1.35; }
  .btn:hover { border-color:#2a3a55; box-shadow:0 0 0 3px var(--ring); }
  .btn:active { transform: translateY(1px); }
  .btn[disabled] { opacity:.5; cursor:not-allowed; }
  .btn.secondary { background:#0d1320; font-weight:500; }
  .btn.warn { background:#1a1406; border-color:#3b2d10; }
  .btn.good { background:#0f1a11; border-color:#1c3b2a; }
  .capsule { display:inline-block; padding:2px 6px; border:1px solid var(--border); border-radius:999px; font-size:11px; color:var(--muted); }
  .table { width:100%; border-collapse:collapse; font-size:13px; }
  .table th, .table td { border-bottom:1px solid var(--border); padding:6px 8px; text-align:left; }
  .table th { color:var(--muted); font-weight:600; }
  .log { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; background:#0b1220; border:1px solid var(--border); padding:10px; border-radius:10px; height:220px; overflow:auto; }
  .axisCard { background:#0b1220; border:1px solid var(--border); padding:12px; border-radius:10px; }
  .axisLabel { font-size:16px; font-weight:700; }
  .pure { color:var(--ok); }
  .wobble { color:var(--warn); }
  .off { color:var(--danger); }
  .small { font-size:11px; color:var(--muted); }
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <span class="badge">GROUND ZERO</span>
    <h1>Text Q/A • Seeded Engine • Two Locks + Axis Probe</h1>
  </div>
  <div class="sub">Deterministic engine. Options are the answer sentences. Locking cap = 21. Axis Probe runs after locks and ignores the cap.</div>

  <div class="grid">
    <div class="card">
      <div class="row" style="justify-content:space-between;">
        <div class="row">
          <span class="pill">Locking Q <span id="qLock">0</span> / 21</span>
          <span class="pill">Stage <span id="stage">—</span></span>
          <span class="pill">Active: <span id="activeCount">12</span></span>
        </div>
        <div class="row">
          <button id="btnStart" class="btn secondary">Start</button>
          <button id="btnReset" class="btn">Reset</button>
        </div>
      </div>

      <div class="row" style="margin-top:10px;justify-content:space-between;">
        <div class="row" style="gap:8px;">
          <div id="slotMain" class="slot">Main</div>
          <div id="slotSecondary" class="slot">Secondary</div>
        </div>
        <div class="row" style="gap:8px;">
          <span class="capsule">Last lock at Q<span id="lastLockQ">0</span></span>
          <span class="capsule">Locks: <span id="lockCount">0</span> / 2</span>
        </div>
      </div>

      <div class="sep"></div>

      <div id="questionArea">
        <div class="qmeta" id="qmeta">Press Start to begin.</div>
        <div class="qline" id="qline">—</div>
        <div id="options" class="options"></div>
      </div>

      <div id="axisArea" style="display:none; margin-top:12px;">
        <div class="axisCard">
          <div class="row" style="justify-content:space-between; align-items:flex-start;">
            <div>
              <div style="font-size:14px; color:var(--muted);">Axis Probe (outside cap)</div>
              <div class="axisLabel">Item <span id="probeIdx">0</span> / 3</div>
            </div>
            <div>
              <span class="capsule">Pair: <b id="pairLabel">—</b></span>
            </div>
          </div>
          <div id="probeText" style="margin:8px 0 10px; font-size:15px;"></div>
          <div class="row">
            <button class="btn good" id="btnYes">Yes</button>
            <button class="btn secondary" id="btnMaybe">Maybe</button>
            <button class="btn warn" id="btnNo">No</button>
          </div>
        </div>
      </div>

      <div id="axisResult" style="display:none; margin-top:12px;">
        <div class="axisCard">
          <div class="row" style="justify-content:space-between;">
            <div class="axisLabel">Axis Result: <span id="axisLabel">—</span></div>
            <div><span class="capsule">Score S = <span id="axisScore">0</span></span></div>
          </div>
          <div id="axisLedger" style="margin-top:8px; font-size:13px;"></div>
        </div>
      </div>

      <div style="margin-top:10px; color:var(--muted); font-size:12px;">
        Spec: Q1=5 unique. Q2=seed carry + 4 new (not in Q1). Q3=carry both picks (if different) + all remaining unseen. Lock at 3. Two locks stop the phase. Cap=21 for locking only. Axis Probe then runs 3 fixed items.
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between; align-items:baseline;">
        <h3 style="margin:0;font-size:16px;">Ledger</h3>
        <div class="row">
          <span class="capsule">Exposure floor K=4</span>
          <span class="capsule">Convergence gates at 6Q no-lock</span>
        </div>
      </div>

      <div class="row" style="align-items:flex-start; gap:12px;">
        <div class="grow">
          <table class="table" id="scoreTable">
            <thead><tr><th>Face</th><th>Hits</th><th>Shown</th><th>Status</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="small" style="margin:6px 0;">Scoring: picking an answer adds +1.0 to that answer’s face. Others get 0.</div>
      <div class="log" id="log"></div>
    </div>
  </div>
</div>

<script>
(()=>{
// =========================
// Version-locked constants
// =========================
const VERSION = "v1.2.2-TextQA-12F-twoLocks-21cap+Probe";

const FACES = [
  "Sovereign","Rebel","Visionary","Equalizer","Guardian","Seeker",
  "Architect","Spotlight","Diplomat","Partner","Provider","Artisan"
];

// 21-question bank: per question, prompt + answer text per face.
const QUESTION_BANK = [
  null, // 0 unused to make indexing 1-based with qLock
  {
    prompt: "When you walk into a room of strangers, you…",
    answers: {
      "Sovereign":"Scan who holds power and decide when to speak.",
      "Rebel":"Say something sharp just to watch reactions.",
      "Visionary":"Note the possibilities and imagine new futures.",
      "Equalizer":"Feel the emotional temperature, then bring balance.",
      "Guardian":"Find the safest corner and observe everything first.",
      "Seeker":"Start tracing what’s really going on beneath the polite noise.",
      "Architect":"Map the room’s structure: who plugs into what, what’s the system here.",
      "Spotlight":"Light up the space and claim a slice of stage.",
      "Diplomat":"Bridge cliques with small talk that lowers friction.",
      "Partner":"Find the person with a half-formed idea and make it usable.",
      "Provider":"Blend in and quietly support whomever needs it.",
      "Artisan":"Inspect the craft around you; judge the build quality with your hands and eyes."
    }
  },
  {
    prompt: "Success feels most real when…",
    answers: {
      "Sovereign":"Your call stands and people align around it.",
      "Rebel":"The crowd erupts and you OWN the moment.",
      "Visionary":"The future you sketched shows up in the real world.",
      "Equalizer":"A pattern you proved holds under pressure.",
      "Guardian":"Everyone feels protected and supplied because of you.",
      "Seeker":"You uncover a hidden truth no one else saw.",
      "Architect":"A system you designed runs clean, stable, and elegant.",
      "Spotlight":"The room lights up because your presence lifted it.",
      "Diplomat":"Two rivals shake hands because you bridged them.",
      "Partner":"Your idea becomes tangible and useful to others.",
      "Provider":"Someone quietly says their day worked because you covered the gaps.",
      "Artisan":"A thing you built works perfectly and feels right in the hand."
    }
  },
  {
    prompt: "Conflict shows up. Your first internal move is…",
    answers: {
      "Sovereign":"Command the space and set the terms.",
      "Rebel":"Break the rules to see who notices.",
      "Visionary":"Paint a bigger future so everyone eases up.",
      "Equalizer":"Weigh both sides, balance the charge, cool the room.",
      "Guardian":"Shield the most vulnerable person in the room.",
      "Seeker":"Search for the underlying pattern you’re missing.",
      "Architect":"Diagram the failure points and redesign the interface between them.",
      "Spotlight":"Draw the heat onto yourself and reset the mood.",
      "Diplomat":"Mediate the terms until a workable bridge appears.",
      "Partner":"Turn talk into a small actionable build everyone can move on.",
      "Provider":"Quietly absorb the loose tasks so pressure drops.",
      "Artisan":"Put hands on the broken part and fix the tolerances."
    }
  },
  {
    prompt: "When someone praises you, you secretly…",
    answers: {
      "Sovereign":"Convert it into permission to set a bigger line.",
      "Rebel":"Look for the edge you can push next.",
      "Visionary":"Turn it into fuel for your next big idea.",
      "Equalizer":"Check whether the signal is clean or just noise.",
      "Guardian":"Verify the base is safe before taking a bow.",
      "Seeker":"Dissect why they see you that way at all.",
      "Architect":"Ask whether the system that produced it will scale.",
      "Spotlight":"Want a bigger stage and brighter lights.",
      "Diplomat":"Redirect the credit to keep the peace.",
      "Partner":"Spin it into a concrete next step.",
      "Provider":"Make sure people who helped are stocked and seen.",
      "Artisan":"Go back to your bench and make the next version cleaner."
    }
  },
  {
    prompt: "Your energy spikes when…",
    answers: {
      "Sovereign":"You decree a bold new boundary and feel it hold.",
      "Rebel":"You flip a stale situation upside-down.",
      "Visionary":"You glimpse a future no one else imagined.",
      "Equalizer":"A hidden connection suddenly makes sense.",
      "Guardian":"Protection and provision click into place perfectly.",
      "Seeker":"The riddle you’ve been tracking finally opens.",
      "Architect":"You assemble a design that locks pieces into a coherent whole.",
      "Spotlight":"The room’s attention snaps to the moment you’re shaping.",
      "Diplomat":"A tense thread unwinds because you negotiated it right.",
      "Partner":"A concept becomes a working prototype.",
      "Provider":"Supplies arrive at the exact second they’re needed.",
      "Artisan":"You tune a mechanism until it hums."
    }
  },
  {
    prompt: "Silence feels like…",
    answers: {
      "Sovereign":"A throne room before the decree.",
      "Rebel":"A dare to make some noise.",
      "Visionary":"The blank canvas before the next vision lands.",
      "Equalizer":"An invitation to analyze what isn’t said.",
      "Guardian":"A moment to secure everyone’s safety.",
      "Seeker":"Space to track the unsolved thread.",
      "Architect":"Room to draft the blueprint without interruption.",
      "Spotlight":"A stage with no lights — intolerable.",
      "Diplomat":"A chance to hear what would keep us whole.",
      "Partner":"Breathing room to refine the plan to action.",
      "Provider":"Time to quietly stock the shelves.",
      "Artisan":"The workshop before first cut."
    }
  },
  {
    prompt: "Under extreme stress you usually…",
    answers: {
      "Sovereign":"Take total control and set the path.",
      "Rebel":"Explode the rules so something new can emerge.",
      "Visionary":"Escape into imagination and future-build.",
      "Equalizer":"Break the issue into patterns and fix the root.",
      "Guardian":"Stand guard for everyone else’s safety.",
      "Seeker":"Hunt the missing variable until it confesses.",
      "Architect":"Redesign the system so this failure can’t repeat.",
      "Spotlight":"Draw heat and attention to rally momentum.",
      "Diplomat":"Broker a ceasefire and buy time.",
      "Partner":"Build the small, sure fix that moves us one square.",
      "Provider":"Cover the unglamorous tasks so others can breathe.",
      "Artisan":"Put tools on the table and start repairing."
    }
  },
  {
    prompt: "The compliment that hits deepest is…",
    answers: {
      "Sovereign":"“You made the hard call and it was right.”",
      "Rebel":"“You shook us awake.”",
      "Visionary":"“You pulled the future closer.”",
      "Equalizer":"“You saw the real issue before anyone else.”",
      "Guardian":"“I felt safe because you were there.”",
      "Seeker":"“You found the truth under the noise.”",
      "Architect":"“Your design is clean and it scales.”",
      "Spotlight":"“You lit the room on fire.”",
      "Diplomat":"“You kept us together when it mattered.”",
      "Partner":"“You turned an idea into something we could use.”",
      "Provider":"“You had what we needed before we asked.”",
      "Artisan":"“This feels crafted, not just made.”"
    }
  },
  {
    prompt: "A perfect day ends with…",
    answers: {
      "Sovereign":"Standing somewhere no one can command me.",
      "Rebel":"Knowing I disrupted what needed disrupting.",
      "Visionary":"Sketching the seed of the next impossible thing.",
      "Equalizer":"Solving a puzzle that bothered me for weeks.",
      "Guardian":"Seeing everyone supplied and settled.",
      "Seeker":"Cracking a mystery that finally yields.",
      "Architect":"A framework drafted that clarifies the mess.",
      "Spotlight":"An audience leaving brighter than they arrived.",
      "Diplomat":"Two tense threads I tied into one rope.",
      "Partner":"Shipping a tidy prototype that works.",
      "Provider":"Knowing the fridges are stocked and the lists are done.",
      "Artisan":"A piece finished so clean it makes me smile."
    }
  },
  {
    prompt: "Which loss would cut deepest?",
    answers: {
      "Sovereign":"My authority to draw the line.",
      "Rebel":"My right to break the frame.",
      "Visionary":"My horizon of what could be.",
      "Equalizer":"My ability to trust the pattern.",
      "Guardian":"My duty to keep people safe.",
      "Seeker":"My capacity to find the hidden truth.",
      "Architect":"My blueprint for how it all fits.",
      "Spotlight":"My platform to move a room.",
      "Diplomat":"My standing with both sides.",
      "Partner":"My knack for turning ideas real.",
      "Provider":"My role as the one who provides.",
      "Artisan":"My hands’ memory for the craft."
    }
  },
  {
    prompt: "How do you rebuild after failure?",
    answers: {
      "Sovereign":"Redraw the power lines and claim them.",
      "Rebel":"Burn the rubble and start louder.",
      "Visionary":"Turn failure into concept fuel.",
      "Equalizer":"Analyze pattern errors until it clicks.",
      "Guardian":"Fortify the foundation stronger than before.",
      "Seeker":"Track the missing fact and correct it.",
      "Architect":"Re-architect the system so it can’t fail the same way.",
      "Spotlight":"Re-ignite the room so people believe again.",
      "Diplomat":"Broker agreements that unlock the jam.",
      "Partner":"Build the minimal working path forward.",
      "Provider":"Restore supply lines and remove friction.",
      "Artisan":"Rework the piece until tolerances are true."
    }
  },
  {
    prompt: "What keeps you awake at night most often?",
    answers: {
      "Sovereign":"The cost of not choosing.",
      "Spotlight":"The silence after the applause ends.",
      "Visionary":"Visions that refuse to sleep.",
      "Equalizer":"An equation that still doesn’t balance.",
      "Guardian":"Worry someone I love isn’t protected.",
      "Seeker":"A riddle I can’t yet decode.",
      "Architect":"A design flaw I haven’t simplified yet.",
      "Diplomat":"A fight that didn’t need to be a fight.",
      "Partner":"A build I haven’t started but need to.",
      "Provider":"A gap in supply that could hurt someone tomorrow.",
      "Artisan":"A piece that won’t sit flush.",
      "Rebel":"Rules that still deserve breaking."
    }
  },
  {
    prompt: "You learn best when…",
    answers: {
      "Sovereign":"Thrown into command with real consequences.",
      "Rebel":"Facing resistance loud enough to push back.",
      "Visionary":"Prototyping wild ideas against the clock.",
      "Equalizer":"Left to break apart the system myself.",
      "Guardian":"Building safe frameworks from the ground up.",
      "Seeker":"Following the trail of unknowns until they’re known.",
      "Architect":"Drafting schemas and testing interfaces.",
      "Spotlight":"Performing under bright feedback.",
      "Diplomat":"Negotiating with people who want different things.",
      "Partner":"Turning sketches into tools.",
      "Provider":"Carrying responsibility for real outcomes.",
      "Artisan":"Working with materials until the feel is right."
    }
  },
  {
    prompt: "Final question: At the edge of everything, what remains?",
    answers: {
      "Sovereign":"A line only I can draw.",
      "Rebel":"A spark of revolt waiting to ignite.",
      "Visionary":"An impossible vision calling me forward.",
      "Equalizer":"A pattern that still holds true.",
      "Guardian":"A wall strong enough for the next to rest on.",
      "Seeker":"A riddle still worth solving.",
      "Architect":"A blueprint for a world that works.",
      "Spotlight":"A light that refuses to dim.",
      "Diplomat":"A bridge where there was none.",
      "Partner":"A tool that makes tomorrow easier.",
      "Provider":"A promise to provide what’s needed.",
      "Artisan":"A craft that outlasts its maker."
    }
  },
  {
    prompt: "What is your deepest truth?",
    answers: {
      "Sovereign":"I am free to choose my own path.",
      "Rebel":"I break what needs breaking.",
      "Visionary":"I imagine what could be.",
      "Equalizer":"I see patterns others miss.",
      "Guardian":"I protect what I love.",
      "Seeker":"I seek the truth beneath the story.",
      "Architect":"I make order that lasts.",
      "Spotlight":"I turn moments into momentum.",
      "Diplomat":"I keep the peace without losing the edge.",
      "Partner":"I make ideas real.",
      "Provider":"I carry what needs carrying.",
      "Artisan":"I shape with care until it’s right."
    }
  },
  {
    prompt: "People count on you most for…",
    answers: {
      "Sovereign":"Drawing direction when others hesitate.",
      "Rebel":"Shaking the stuck thing loose.",
      "Visionary":"Naming a horizon that rallies people.",
      "Equalizer":"Finding the signal inside the noise.",
      "Guardian":"Keeping the base supplied and stable.",
      "Seeker":"Tracing root causes calmly.",
      "Architect":"Turning chaos into working structure.",
      "Spotlight":"Turning moments into momentum.",
      "Diplomat":"Cooling tensions and aligning humans.",
      "Partner":"Turning a loose idea into something real.",
      "Provider":"Showing up beside them without being asked.",
      "Artisan":"Delivering quality under pressure."
    }
  },
  {
    prompt: "When the stakes spike, your edge is…",
    answers: {
      "Sovereign":"Setting the terms so the game is clear.",
      "Rebel":"Cracking stale frames so oxygen can enter.",
      "Visionary":"Seeing the future fast enough to steer now.",
      "Equalizer":"Diagramming the pattern until it yields.",
      "Guardian":"Locking the perimeter so nothing breaks through.",
      "Seeker":"Hunting the blind spot no one else sees.",
      "Architect":"Re-architecting constraints into clarity.",
      "Spotlight":"Rallying energy in the room on command.",
      "Diplomat":"Translating competitors into collaborators.",
      "Partner":"Converting uncertainty into a concrete next step.",
      "Provider":"Bringing what’s missing exactly on time.",
      "Artisan":"Tightening tolerances until failure disappears."
    }
  },
  {
    prompt: "If a friend calls at 2 AM, you…",
    answers: {
      "Sovereign":"Set the line: what we’re doing, now.",
      "Rebel":"Bring heat and courage to cut through the fog.",
      "Visionary":"Reframe their future so they can move.",
      "Equalizer":"Trace the root cause and map next steps.",
      "Guardian":"Stabilize the scene and keep them safe.",
      "Seeker":"Ask precise questions until the truth lands.",
      "Architect":"Design a simple system they can follow half-asleep.",
      "Spotlight":"Rally them with presence so they don’t quit.",
      "Diplomat":"Call the person who needs to hear them and broker peace.",
      "Partner":"Build a small, do-able plan together.",
      "Provider":"Bring what they need and stay until morning.",
      "Artisan":"Fix the broken thing before dawn."
    }
  },
  {
    prompt: "When a plan stalls, you instinctively…",
    answers: {
      "Sovereign":"Reassert direction and cut the drift.",
      "Rebel":"Kick the sacred cow blocking motion.",
      "Visionary":"Reframe with a bolder future so energy returns.",
      "Equalizer":"Audit the logic chain and fix the weak link.",
      "Guardian":"Rebuild the safety floor so people can move.",
      "Seeker":"Find the missing variable and slot it in.",
      "Architect":"Redesign the workflow so friction drops.",
      "Spotlight":"Create a moment that pulls everyone back in.",
      "Diplomat":"Get the right people talking the right way.",
      "Partner":"Ship a tiny win to restart momentum.",
      "Provider":"Clear bottlenecks by covering the grunt work.",
      "Artisan":"Tune the mechanism until it cycles clean."
    }
  },
  {
    prompt: "On a brand-new team, you optimize first for…",
    answers: {
      "Sovereign":"Clear authority and crisp decision paths.",
      "Rebel":"A culture that isn’t afraid to break what’s broken.",
      "Visionary":"A horizon worth chasing.",
      "Equalizer":"Truth map: what’s actually happening vs story.",
      "Guardian":"Reliable safety nets and predictable cadence.",
      "Seeker":"Instrumentation to learn quickly from reality.",
      "Architect":"Interfaces, standards, and clean contracts.",
      "Spotlight":"Signal, hype, and a strong launch moment.",
      "Diplomat":"Conflict protocols that keep us whole.",
      "Partner":"Fast prototypes that make decisions real.",
      "Provider":"Baselines: supply, tooling, checklists.",
      "Artisan":"Craft discipline so output quality stays high."
    }
  },
  {
    prompt: "At your best, others experience you as…",
    answers: {
      "Sovereign":"A clear axis the room can orient to.",
      "Rebel":"A necessary disruption that restarts life.",
      "Visionary":"A horizon that pulls possibility closer.",
      "Equalizer":"A decoder ring for hard problems.",
      "Guardian":"A shield the whole group can rest behind.",
      "Seeker":"A lantern for the unknown.",
      "Architect":"A builder of systems that last.",
      "Spotlight":"A spark that turns rooms alive.",
      "Diplomat":"A bridge that holds under load.",
      "Partner":"A maker of the next practical step.",
      "Provider":"A quiet force that keeps things working.",
      "Artisan":"A craftsperson who brings precision and calm."
    }
  }
];

// Axis Probe bank exactly as spec (12 mains × 11 secondaries × 3 items).
const AXIS_BANK = {
"Sovereign": {
"Rebel": [
"I take charge even if it means breaking the rules.",
"If a rule slows us down, I’ll change it.",
"I’d rather lead than be managed."
],
"Visionary": [
"I want to call the shots that open the future, not just repeat the past.",
"If a better path shows up, I’ll change direction.",
"I feel it’s on me to push toward what’s next."
],
"Equalizer": [
"I want control, but only if the setup is fair.",
"If it’s lopsided, I’ll hold back until it’s fixed.",
"I lead in ways that keep the balance."
],
"Guardian": [
"I’ll lead, but I stop if it’s clearly unsafe.",
"I don’t want progress if it risks breaking people.",
"My decisions have to protect the group."
],
"Seeker": [
"I choose the unknown even when I’m the one steering.",
"Curiosity drives the call.",
"I own the risk of discovery."
],
"Architect": [
"I won’t make a call until the system underneath makes sense.",
"I want structure before I move.",
"I direct things to be repeatable, not one-off."
],
"Spotlight": [
"When I decide, I don’t hide it.",
"I’ll step into view to make sure the choice sticks.",
"I want the call to be public, not private."
],
"Diplomat": [
"I’ll lead, but I try to keep everyone on board.",
"If my way blows up alignment, I’ll adjust.",
"I want the last word, but not if it burns the group."
],
"Partner": [
"I want the call, but I don’t want to leave people behind.",
"I’ll match pace so we move together.",
"I don’t pick paths that cut others off."
],
"Provider": [
"I decide, but only after the basics are set.",
"I line up resources before I push.",
"I own the timing so the run doesn’t collapse."
],
"Artisan": [
"I decide, then I prove it by building.",
"I test my calls with real work.",
"I stand by choices I can show in practice."
]
},
"Rebel": {
"Sovereign": [
"I refuse to be controlled and make my own calls.",
"If rules are bad, I won’t follow them.",
"I’ll rewrite the script to get my way."
],
"Visionary": [
"I ditch the present to push into the future.",
"I’ll break what’s stale to unlock what’s new.",
"I’ll bend direction if tomorrow looks better."
],
"Equalizer": [
"I fight setups that give someone too much power.",
"I challenge terms that aren’t even.",
"I break what feels rigged."
],
"Guardian": [
"I resist moves that endanger people.",
"I stop reckless speed.",
"I won’t follow a path that looks unsafe."
],
"Seeker": [
"I go against the known to chase the unknown.",
"I reject safe answers if curiosity is calling.",
"I change rules so discovery can happen."
],
"Architect": [
"I hate hacks and quick fixes.",
"I’ll scrap a brittle system just to build it better.",
"I push back until the design is clean."
],
"Spotlight": [
"I’ll speak up in public when things are wrong.",
"I use visibility to fight bad norms.",
"I want the mic if it sparks change."
],
"Diplomat": [
"I resist authority, but I still explain myself.",
"I’d rather negotiate better terms than submit.",
"I’ll translate my push so others get it."
],
"Partner": [
"I don’t ditch people just to win a fight.",
"I pace my rebellion so we don’t split.",
"I’ll take risks together, not alone."
],
"Provider": [
"I fight scarcity by supplying what’s missing.",
"I route around blockages with resources.",
"I support change with real stuff."
],
"Artisan": [
"I prove my point by making something better.",
"I’ll build instead of argue.",
"My protest is a working demo."
]
},
"Visionary": {
"Sovereign": [
"I see what’s next and I want to lead us there.",
"If the future shifts, I’ll change direction.",
"I pick options that expand tomorrow."
],
"Rebel": [
"I drop the old path to reach something new.",
"I break patterns to unlock growth.",
"I move fast when the future pulls."
],
"Equalizer": [
"I imagine futures where no one gets screwed.",
"I won’t chase growth if it leaves people behind.",
"I push for upside that’s shared."
],
"Guardian": [
"I chase new things, but not at any cost.",
"I time risk so people don’t get wrecked.",
"I don’t trade safety for novelty."
],
"Seeker": [
"I explore new options to see what’s possible.",
"Curiosity drives my vision.",
"I follow mystery when the payoff looks real."
],
"Architect": [
"I map the structure before betting on the future.",
"I want design before I sprint.",
"I build futures that last."
],
"Spotlight": [
"I paint pictures people can follow.",
"I tell the story of the future.",
"I make tomorrow clear now."
],
"Diplomat": [
"I bring people along into what’s next.",
"I translate risk into terms they’ll accept.",
"I pick paths that most can walk."
],
"Partner": [
"I want to reach the future with others, not solo.",
"I sync pace so we arrive together.",
"I pick options that don’t cut ties."
],
"Provider": [
"I gather resources before pushing ahead.",
"I stage basics before big moves.",
"I pace visions with stability."
],
"Artisan": [
"I test ideas by building them.",
"I cut through theory with practice.",
"I only believe the vision once I can touch it."
]
},
"Equalizer": {
"Sovereign": [
"I want control that doesn’t tilt the table.",
"If it’s unfair, I slow the leader down.",
"I set limits on power."
],
"Rebel": [
"I fight setups that give some people an edge.",
"I resist rules that exploit others.",
"I break what feels rigged."
],
"Visionary": [
"I see futures where the gains aren’t just for a few.",
"I won’t chase growth if it leaves people behind.",
"I push for upside that’s shared."
],
"Guardian": [
"I enforce safety without playing favorites.",
"I stop if the risk falls unevenly.",
"I protect those carrying more than their share."
],
"Seeker": [
"I investigate hidden imbalances before moving.",
"I’ll pause curiosity to fix fairness.",
"I chase discovery that doesn’t exploit."
],
"Architect": [
"I design systems that spread effort evenly.",
"I won’t launch structures that load one side.",
"I fix designs that keep things lopsided."
],
"Spotlight": [
"I call out when someone’s hogging attention.",
"I want credit to be shared, not stacked.",
"I use visibility to balance the story."
],
"Diplomat": [
"I push for trades that feel even.",
"I cool fights by making terms fair.",
"I want everyone walking away with something."
],
"Partner": [
"I don’t let one person do all the work.",
"I match pace so the load is equal.",
"I share credit and blame."
],
"Provider": [
"I step in to fill gaps when others can’t.",
"I make sure supplies don’t get hoarded.",
"I keep resources distributed."
],
"Artisan": [
"I fix problems hands-on until they’re fair.",
"I won’t stop until the work is even.",
"I balance through making, not just talk."
]
},
"Guardian": {
"Sovereign": [
"I’ll follow a leader only if safety is respected.",
"I say no when the call risks breaking people.",
"I’ll stop progress if it crosses the line."
],
"Rebel": [
"I resist reckless control.",
"I’ll push back if people are being put at risk.",
"I don’t obey rules that ignore safety."
],
"Visionary": [
"I want new ideas, but not if they’re reckless.",
"I slow down visions that skip safety.",
"I pick novelty only if it holds the line."
],
"Equalizer": [
"I enforce rules the same for everyone.",
"I stop if one person shoulders more danger.",
"I don’t allow risk to pile up unevenly."
],
"Seeker": [
"I chase the unknown only inside safe limits.",
"Curiosity won’t make me ignore danger.",
"I stop if the risk is too high."
],
"Architect": [
"I design protections before anything launches.",
"I’ll reject systems that cut safety corners.",
"I build frameworks that guard people first."
],
"Spotlight": [
"I speak up when danger’s ignored.",
"I use visibility to stop reckless moves.",
"I go public if that’s the only way to keep it safe."
],
"Diplomat": [
"I negotiate limits everyone can accept.",
"I explain safety rules to calm things down.",
"I push for agreements that reduce risk."
],
"Partner": [
"I slow down to protect others.",
"I won’t let someone take all the hits.",
"I guard people before goals."
],
"Provider": [
"I make sure basics are covered before we move.",
"I stock safety nets.",
"I resource things so risk doesn’t spike."
],
"Artisan": [
"I test things carefully before release.",
"I refuse shortcuts under pressure.",
"I prove safety with my own hands."
]
},
"Seeker": {
"Sovereign": [
"I want freedom to chase the unknown.",
"I’ll explore even if I’m steering.",
"I take charge to discover."
],
"Rebel": [
"I break rules if they block curiosity.",
"I defy the known to find new ground.",
"I won’t accept stale answers."
],
"Visionary": [
"I look to the future and go exploring.",
"I chase mystery to see what’s possible.",
"I move toward upside no one sees yet."
],
"Equalizer": [
"I pause to check if discovery is fair.",
"I don’t exploit what I find.",
"I share the unknown, not hoard it."
],
"Guardian": [
"I explore but I listen to danger signals.",
"Curiosity doesn’t excuse unsafe moves.",
"I stop if the risk is too high."
],
"Architect": [
"I investigate systems to see how they work.",
"I discover flaws others miss.",
"I push curiosity into clean design."
],
"Spotlight": [
"I talk openly about what I find.",
"I bring others along into new territory.",
"I make discovery visible."
],
"Diplomat": [
"I explore and then translate findings.",
"I explain unknowns so others can move.",
"I share discovery in usable ways."
],
"Partner": [
"I don’t want to explore alone.",
"I check in so we’re still together.",
"I share discovery with people I trust."
],
"Provider": [
"I set up supplies before going off trail.",
"I won’t explore if the basics aren’t ready.",
"I pace curiosity with stability."
],
"Artisan": [
"I explore by building.",
"I learn by doing, not just imagining.",
"I trust discoveries I can touch."
]
},
"Architect": {
"Sovereign": [
"I won’t follow a leader without a solid system.",
"I stop launches that ignore structure.",
"I want control that respects design."
],
"Rebel": [
"I tear down brittle setups.",
"I break hacks to rebuild right.",
"I reject mess and demand structure."
],
"Visionary": [
"I design the base before chasing the future.",
"I want vision that can scale.",
"I pick futures with bones that hold."
],
"Equalizer": [
"I design systems that share effort evenly.",
"I fix structures that overburden.",
"I won’t ship something unfair."
],
"Guardian": [
"I add guardrails before speed.",
"I refuse shortcuts that risk safety.",
"I design protections in from the start."
],
"Seeker": [
"I explore by mapping how things work.",
"I turn curiosity into clean structure.",
"I test unknowns by systemizing them."
],
"Spotlight": [
"I present designs clearly.",
"I make frameworks visible so they’re trusted.",
"I explain systems in public."
],
"Diplomat": [
"I negotiate designs people can live with.",
"I translate structure into plain terms.",
"I settle fights through better rules."
],
"Partner": [
"I co-build so no one does it alone.",
"I sync workflow for cleaner results.",
"I design teamwork into the system."
],
"Provider": [
"I supply structure like a resource.",
"I make sure foundations are stocked.",
"I build scaffolds others can rely on."
],
"Artisan": [
"I prove design by making.",
"I refine frameworks hands-on.",
"I test structure in real builds."
]
},
"Spotlight": {
"Sovereign": [
"I show the call in public.",
"I carry decisions into view.",
"I lead by being visible."
],
"Rebel": [
"I use the mic to push back.",
"I go public when something’s wrong.",
"I won’t stay quiet about bad control."
],
"Visionary": [
"I paint pictures people can follow.",
"I tell the story of the future.",
"I make tomorrow clear now."
],
"Equalizer": [
"I call out unfair setups.",
"I push visibility toward balance.",
"I shine light on what’s hidden."
],
"Guardian": [
"I raise alarms when things are unsafe.",
"I bring danger into view.",
"I won’t let risk stay unseen."
],
"Seeker": [
"I share discoveries out loud.",
"I talk about the unknowns I find.",
"I make curiosity visible."
],
"Architect": [
"I explain frameworks to the crowd.",
"I put systems in plain view.",
"I make design obvious."
],
"Diplomat": [
"I speak so sides understand each other.",
"I frame messages to calm conflict.",
"I translate conflict into clarity."
],
"Partner": [
"I give credit publicly.",
"I highlight others as much as myself.",
"I share the stage."
],
"Provider": [
"I shine light on who makes things possible.",
"I spotlight resources others miss.",
"I call out support work."
],
"Artisan": [
"I show the work, not just talk.",
"I display what I’ve built.",
"I make making visible."
]
},
"Diplomat": {
"Sovereign": [
"I soften commands so they land.",
"I keep leaders from blowing things up.",
"I make decisions easier to accept."
],
"Rebel": [
"I translate defiance so others get it.",
"I argue for fairer terms.",
"I explain rebellion without wrecking trust."
],
"Visionary": [
"I describe the future in simple terms.",
"I make risky ideas acceptable.",
"I align people with what’s next."
],
"Equalizer": [
"I strike deals that feel fair.",
"I cut tension with balanced terms.",
"I want everyone to leave with something."
],
"Guardian": [
"I explain safety rules so they stick.",
"I get buy-in on limits.",
"I frame rules as protection, not punishment."
],
"Seeker": [
"I explain discoveries in plain words.",
"I make unknowns less scary.",
"I translate curiosity into steps."
],
"Architect": [
"I negotiate rules people can live with.",
"I bridge design fights.",
"I find consensus in systems."
],
"Spotlight": [
"I shape the story to calm conflict.",
"I make sides feel seen.",
"I use visibility to keep peace."
],
"Partner": [
"I smooth over fights between teammates.",
"I explain perspectives so we stay aligned.",
"I keep the group steady."
],
"Provider": [
"I broker access to resources.",
"I explain shortages without blame.",
"I negotiate who gets what."
],
"Artisan": [
"I mediate through examples.",
"I show instead of argue.",
"I prove balance with working stuff."
]
},
"Partner": {
"Sovereign": [
"I stick close even if they lead.",
"I pace myself with the decision-maker.",
"I back the person making the call."
],
"Rebel": [
"I won’t let them fight alone.",
"I share the cost of breaking rules.",
"I support the push even if it’s risky."
],
"Visionary": [
"I want to reach the future together.",
"I match pace to stay aligned.",
"I care less about solo glory than shared progress."
],
"Equalizer": [
"I make sure no one carries more than me.",
"I share credit and blame.",
"I balance the load."
],
"Guardian": [
"I slow down to protect people.",
"I refuse to leave anyone exposed.",
"I won’t accept wins that break others."
],
"Seeker": [
"I don’t want to explore alone.",
"I check in so we’re still connected.",
"I share discoveries openly."
],
"Architect": [
"I co-build so no one owns it all.",
"I sync workflow with others.",
"I want shared design, not solo genius."
],
"Spotlight": [
"I give others credit in public.",
"I share the stage.",
"I highlight teammates first."
],
"Diplomat": [
"I cool fights between friends.",
"I explain both sides so we stay intact.",
"I keep the group steady."
],
"Provider": [
"I step in so people aren’t left hanging.",
"I cover gaps.",
"I give stability people can lean on."
],
"Artisan": [
"I work side by side.",
"I build with people, not apart.",
"I prove loyalty by making."
]
},
"Provider": {
"Sovereign": [
"I set up resources before the leader pushes.",
"I won’t let calls collapse for lack of basics.",
"I keep timing grounded."
],
"Rebel": [
"I supply what’s missing so change can happen.",
"I block scarcity from killing momentum.",
"I back rebellion with real stuff."
],
"Visionary": [
"I line up basics before chasing the future.",
"I stage resources so visions can run.",
"I won’t let ideas die for lack of fuel."
],
"Equalizer": [
"I make sure resources aren’t hoarded.",
"I fill gaps evenly.",
"I distribute basics fairly."
],
"Guardian": [
"I resource safety first.",
"I stock protection.",
"I cover needs so risk drops."
],
"Seeker": [
"I prep supplies before exploration.",
"I won’t move unless basics are ready.",
"I back curiosity with stability."
],
"Architect": [
"I build scaffolds others can use.",
"I set up structure like resources.",
"I lay foundations before scale."
],
"Spotlight": [
"I highlight the support behind the show.",
"I make sure credit goes to the unseen.",
"I shine light on what holds things up."
],
"Diplomat": [
"I negotiate who gets what.",
"I explain shortages without blame.",
"I spread resources carefully."
],
"Partner": [
"I step in so people aren’t left hanging.",
"I cover others’ needs.",
"I keep things steady so we stay together."
],
"Artisan": [
"I create tools people can actually use.",
"I supply solutions hands-on.",
"I make stability real."
]
},
"Artisan": {
"Sovereign": [
"I prove calls by building them.",
"I test leadership decisions in practice.",
"I show results with my hands."
],
"Rebel": [
"I protest by making something better.",
"I replace arguments with working models.",
"I disrupt with prototypes."
],
"Visionary": [
"I turn ideas into things.",
"I clear fuzziness by building.",
"I test futures in real form."
],
"Equalizer": [
"I fix imbalance by adjusting the work.",
"I make fairness hands-on.",
"I balance load with what I create."
],
"Guardian": [
"I test carefully under pressure.",
"I refuse shortcuts that break safety.",
"I prove caution in real builds."
],
"Seeker": [
"I explore by making.",
"I learn with tools, not just imagining.",
"I trust what I can build."
],
"Architect": [
"I design through building.",
"I refine frameworks hands-on.",
"I prove systems by making them real."
],
"Spotlight": [
"I show the work instead of talking.",
"I display what I’ve built.",
"I make craft visible."
],
"Diplomat": [
"I explain through examples.",
"I prove points by showing, not arguing.",
"I bridge fights with working stuff."
],
"Partner": [
"I work side by side.",
"I share tasks in the build.",
"I prove loyalty in practice."
],
"Provider": [
"I make tools that cover needs.",
"I supply fixes through craft.",
"I create stability hands-on."
]
}
};

// =========================
// State
// =========================
const state = {
  version: VERSION,
  qLock: 0,                    // locking-phase question count (capped at 21)
  stage: 0,                    // 0 idle, cycles 1..3
  active: FACES.slice(),       // active faces
  hits: Object.fromEntries(FACES.map(f=>[f,0])),
  shown: Object.fromEntries(FACES.map(f=>[f,0])),
  lastShownQ: Object.fromEntries(FACES.map(f=>[f,0])),
  locked: [],                  // [Main, Secondary]
  lastLockQ: 0,
  qSinceLock: 0,
  currentSeed: null,           // seed key modeled as last picked face id
  cycleSeen: new Set(),        // coverage per cycle
  cyclePicks: [],              // [P1, P2]
  log: [],
  // Probe state
  mode: "lock",                // "lock" | "probe" | "done"
  probeItems: [],              // 3 strings
  probeIdx: 0,                 // 0..2
  probeScore: 0,               // sum -1..+3
  probeAnswers: []             // "Yes"/"Maybe"/"No"
};

// =========================
// DOM
// =========================
const elQ = document.getElementById("qLock");
const elStage = document.getElementById("stage");
const elActiveCount = document.getElementById("activeCount");
const elOptions = document.getElementById("options");
const elQline = document.getElementById("qline");
const elQmeta = document.getElementById("qmeta");
const btnStart = document.getElementById("btnStart");
const btnReset = document.getElementById("btnReset");
const elSlotMain = document.getElementById("slotMain");
const elSlotSecondary = document.getElementById("slotSecondary");
const elLastLockQ = document.getElementById("lastLockQ");
const elLockCount = document.getElementById("lockCount");
const elScoreBody = document.querySelector("#scoreTable tbody");
const elLog = document.getElementById("log");

const elAxisArea = document.getElementById("axisArea");
const elAxisResult = document.getElementById("axisResult");
const elProbeIdx = document.getElementById("probeIdx");
const elPairLabel = document.getElementById("pairLabel");
const elProbeText = document.getElementById("probeText");
const btnYes = document.getElementById("btnYes");
const btnMaybe = document.getElementById("btnMaybe");
const btnNo = document.getElementById("btnNo");
const elAxisLabel = document.getElementById("axisLabel");
const elAxisScore = document.getElementById("axisScore");
const elAxisLedger = document.getElementById("axisLedger");

// =========================
// Utils
// =========================
function log(line){
  const t = `[${state.mode.toUpperCase()}][Q${state.qLock.toString().padStart(2,"0")}][S${state.stage}] ${line}`;
  state.log.push(t);
  if (state.log.length>500) state.log.shift();
  elLog.textContent = state.log.join("\\n");
  elLog.scrollTop = elLog.scrollHeight;
}
function updateHeader(){
  elQ.textContent = state.qLock;
  elStage.textContent = state.mode==="lock" ? (state.stage||"—") : "—";
  elActiveCount.textContent = state.active.length;
  elLastLockQ.textContent = state.lastLockQ;
  elLockCount.textContent = state.locked.length;
  if (state.locked[0]){ elSlotMain.classList.add("filled"); elSlotMain.textContent = state.locked[0]; } else { elSlotMain.classList.remove("filled"); elSlotMain.textContent = "Main"; }
  if (state.locked[1]){ elSlotSecondary.classList.add("filled"); elSlotSecondary.textContent = state.locked[1]; } else { elSlotSecondary.classList.remove("filled"); elSlotSecondary.textContent = "Secondary"; }
}
function updateScore(){
  const rows = FACES.map(id => {
    const hits = state.hits[id];
    const shown = state.shown[id];
    let status = state.locked.includes(id) ? `Locked #${state.locked.indexOf(id)+1}` : (state.active.includes(id) ? "Active" : "Excluded");
    return `<tr><td>${id}</td><td>${hits}</td><td>${shown}</td><td>${status}</td></tr>`;
  }).join("");
  elScoreBody.innerHTML = rows;
}
function setOptions(cols){
  elOptions.style.gridTemplateColumns = `repeat(${Math.min(5, Math.max(1, cols))}, 1fr)`;
}
function unique(arr){ const out=[]; for(const x of arr){ if(!out.includes(x)) out.push(x); } return out; }
function canonicalActive(){ return FACES.filter(id => state.active.includes(id)); }
function clusterOrder(seed, list){
  const ids = list.slice();
  const idx = ids.indexOf(seed);
  if (idx<0) return ids.slice();
  const out = [ids[idx]];
  const n = ids.length;
  for (let k=1;k<n;k++){
    const r = ids[(idx+k)%n];
    const l = ids[(idx-k+n)%n];
    if (!out.includes(r)) out.push(r);
    if (!out.includes(l)) out.push(l);
  }
  return out;
}
function exposureStarved(K=4){
  return canonicalActive().filter(id => (state.qLock - state.lastShownQ[id]) >= K);
}

// =========================
// Composition rules
// =========================
function composeQ1(){
  const act = canonicalActive();
  let picks = [];
  if (state.currentSeed && act.includes(state.currentSeed)){
    const pref = clusterOrder(state.currentSeed, act);
    picks = pref.filter(id => !state.cycleSeen.has(id)).slice(0,5);
  } else {
    picks = act.filter(id => !state.cycleSeen.has(id)).slice(0,5);
  }
  for (const id of exposureStarved()){
    if (!picks.includes(id) && !state.cycleSeen.has(id) && picks.length<5) picks.push(id);
  }
  for (const id of act){
    if (!state.cycleSeen.has(id) && !picks.includes(id) && picks.length<5) picks.push(id);
  }
  if (act.length<5) picks = act.slice();
  return unique(picks);
}
function composeQ2(p1){
  const act = canonicalActive();
  const out = [];
  if (p1 && act.includes(p1)) out.push(p1);
  const candidates = act.filter(id => !state.cycleSeen.has(id) && id!==p1);
  const pref = clusterOrder(p1, act).filter(id => candidates.includes(id));
  const leastShown = candidates.slice().sort((a,b)=>{
    if (state.shown[a]!==state.shown[b]) return state.shown[a]-state.shown[b];
    return act.indexOf(a)-act.indexOf(b);
  });
  const merged = unique(pref.concat(leastShown));
  for (const id of merged){
    if (out.length>=5) break;
    if (!out.includes(id)) out.push(id);
  }
  for (const id of exposureStarved()){
    if (out.length>=5) break;
    if (!out.includes(id) && !state.cycleSeen.has(id)) out.push(id);
  }
  for (const id of candidates){
    if (out.length>=5) break;
    if (!out.includes(id)) out.push(id);
  }
  return unique(out).slice(0,5);
}
function composeQ3(p1,p2){
  const act = canonicalActive();
  const carry = [];
  if (p2 && act.includes(p2)) carry.push(p2);
  if (p1 && act.includes(p1) && p1!==p2) carry.push(p1);
  const leftovers = act.filter(id => !state.cycleSeen.has(id) && !carry.includes(id));
  const merged = unique(carry.concat(leftovers));
  return merged;
}

// =========================
// Engine
// =========================
function start(){
  Object.assign(state, {
    qLock: 0, stage:0, active: FACES.slice(),
    hits: Object.fromEntries(FACES.map(f=>[f,0])),
    shown: Object.fromEntries(FACES.map(f=>[f,0])),
    lastShownQ: Object.fromEntries(FACES.map(f=>[f,0])),
    locked: [], lastLockQ: 0, qSinceLock: 0,
    currentSeed: null, cycleSeen: new Set(), cyclePicks: [], log: [],
    mode: "lock", probeItems: [], probeIdx:0, probeScore:0, probeAnswers: []
  });
  elOptions.innerHTML = "";
  elAxisArea.style.display = "none";
  elAxisResult.style.display = "none";
  elQline.innerHTML = "—";
  elQmeta.innerHTML = "Locking phase started. Pick answers. First to 3 = Main, next to 3 = Secondary.";
  log(`Start • ${state.version}`);
  nextQuestion();
}
function reset(){ start(); }

function nextQuestion(){
  if (state.mode!=="lock"){ return; }
  if (state.locked.length>=2){
    startProbe();
    return;
  }
  if (state.qLock>=21){
    capResolve();
    return;
  }
  state.qLock += 1;
  state.qSinceLock += 1;
  if (state.stage===0 || state.stage===3){
    state.stage = 1;
    state.cycleSeen = new Set();
    state.cyclePicks = [];
  } else {
    state.stage += 1;
  }

  const act = canonicalActive();
  if (act.length===0){
    finalize("No active faces remain.");
    return;
  }

  let options = [];
  if (state.stage===1){
    options = composeQ1();
    if (state.qSinceLock>6){
      const byHits = act.slice().sort((a,b)=>{
        if (state.hits[b]!==state.hits[a]) return state.hits[b]-state.hits[a];
        return act.indexOf(a)-act.indexOf(b);
      });
      const top2 = unique(byHits).slice(0, Math.min(2,act.length));
      const leastShown = act.slice().sort((a,b)=>{
        if (state.shown[a]!==state.shown[b]) return state.shown[a]-state.shown[b];
        return act.indexOf(a)-act.indexOf(b);
      });
      const fill = leastShown.filter(id=>!top2.includes(id)).slice(0, Math.max(0,5-top2.length));
      const nudged = unique(top2.concat(fill));
      options = nudged;
      log(`Convergence gate: nudged Q1 → [${options.join(", ")}]`);
    }
  } else if (state.stage===2){
    options = composeQ2(state.cyclePicks[0]);
  } else if (state.stage===3){
    options = composeQ3(state.cyclePicks[0], state.cyclePicks[1]);
  }

  options.forEach(id => state.cycleSeen.add(id));

  renderLockingQuestion(options);
  updateHeader(); updateScore();
}

function currentPrompt(){
  const idx = Math.min(state.qLock, 21);
  const q = QUESTION_BANK[idx];
  return q ? q.prompt : "—";
}

function answerFor(faceId){
  const idx = Math.min(state.qLock, 21);
  const q = QUESTION_BANK[idx];
  if (!q || !q.answers[faceId]) return faceId;
  return q.answers[faceId];
}

function renderLockingQuestion(optionFaceIds){
  const prompt = currentPrompt();
  elQline.textContent = `Q${state.qLock}: ${prompt}`;
  elQmeta.innerHTML = `Stage <b>${state.stage}</b> • ${state.stage===1 ? "Q1 — new cycle" : state.stage===2 ? "Q2 — seed carry + 4 new" : "Q3 — carry both + leftovers"}`;
  elOptions.innerHTML = "";
  setOptions(optionFaceIds.length);
  for (const faceId of optionFaceIds){
    const b = document.createElement("button");
    b.className = "btn";
    b.textContent = answerFor(faceId);
    b.dataset.face = faceId; // invisible mapping for audit
    b.addEventListener("click", ()=> onPick(faceId, optionFaceIds));
    elOptions.appendChild(b);
  }
  if (optionFaceIds.length===0){
    finalize("No options available.");
  }
}

function onPick(faceId, visibleFaces){
  state.hits[faceId] += 1;
  for (const id of visibleFaces){
    state.shown[id] += 1;
    state.lastShownQ[id] = state.qLock;
  }
  state.currentSeed = faceId;
  if (state.stage===1) state.cyclePicks = [faceId];
  else if (state.stage===2) state.cyclePicks[1] = faceId;

  log(`Pick → ${faceId} (hits=${state.hits[faceId]}) • Answer="${answerFor(faceId)}"`);

  if (!state.locked.includes(faceId) && state.hits[faceId]>=3){
    state.locked.push(faceId);
    state.active = state.active.filter(id=>id!==faceId);
    state.lastLockQ = state.qLock;
    state.qSinceLock = 0;
    log(`<< LOCKED >> ${faceId} at Q${state.qLock}`);
  }

  updateHeader(); updateScore();

  if (state.locked.length>=2){
    startProbe();
  } else if (state.qLock>=21){
    capResolve();
  } else {
    nextQuestion();
  }
}

function capResolve(){
  if (state.locked.length>=2){ startProbe(); return; }
  const remaining = canonicalActive();
  if (remaining.length===0){ startProbe(); return; }
  const sorted = remaining.slice().sort((a,b)=>{
    if (state.hits[b]!==state.hits[a]) return state.hits[b]-state.hits[a];
    if (state.shown[a]!==state.shown[b]) return state.shown[a]-state.shown[b];
    return remaining.indexOf(a)-remaining.indexOf(b);
  });
  const topHits = state.hits[sorted[0]];
  const tied = sorted.filter(id => state.hits[id]===topHits).slice(0,3);
  const mode = tied.length>=3 ? "tri-duel" : "duel";
  elQline.innerHTML = `Cap reached. Sudden-death ${mode}. Pick one to lock.`;
  elOptions.innerHTML = "";
  setOptions(tied.length);
  const idx = Math.min(state.qLock, 21);
  const q = QUESTION_BANK[idx];
  for (const id of tied){
    const b = document.createElement("button");
    b.className = "btn warn";
    b.textContent = q && q.answers[id] ? q.answers[id] : id;
    b.addEventListener("click", ()=>{
      if (!state.locked.includes(id)){
        state.locked.push(id);
        state.active = state.active.filter(x=>x!==id);
        state.lastLockQ = state.qLock;
        log(`<< LOCKED (CAP) >> ${id}`);
      }
      updateHeader(); updateScore();
      if (state.locked.length<2){
        capResolve();
      } else {
        startProbe();
      }
    });
    elOptions.appendChild(b);
  }
  updateHeader(); updateScore();
}

// =========================
// Axis Probe
// =========================
function startProbe(){
  state.mode = "probe";
  elAxisArea.style.display = "block";
  elAxisResult.style.display = "none";
  elOptions.innerHTML = "";
  elQline.innerHTML = "Locking phase complete. Axis Probe begins (uncapped).";
  const main = state.locked[0];
  const secondary = state.locked[1];
  elPairLabel.textContent = `${main} + ${secondary}`;

  const items = (AXIS_BANK[main] && AXIS_BANK[main][secondary]) ? AXIS_BANK[main][secondary] : null;
  if (!items){
    elAxisArea.style.display = "none";
    elAxisResult.style.display = "block";
    const labelEl = document.getElementById("axisLabel");
    labelEl.textContent = "Probe skipped (missing bank)";
    labelEl.className = "axisLabel";
    elAxisScore.textContent = "—";
    elAxisLedger.innerHTML = `<div class="qline">No bank items for ${main}+${secondary}. Fix your versioning.</div>`;
    state.mode = "done";
    log(`Probe skipped: missing bank for ${main}+${secondary}`);
    return;
  }
  state.probeItems = items.slice(0,3);
  state.probeIdx = 0;
  state.probeScore = 0;
  state.probeAnswers = [];
  renderProbeItem();
}

function renderProbeItem(){
  elProbeIdx.textContent = (state.probeIdx+1);
  elProbeText.textContent = state.probeItems[state.probeIdx];
  btnYes.onclick = ()=> probeAnswer("Yes");
  btnMaybe.onclick = ()=> probeAnswer("Maybe");
  btnNo.onclick = ()=> probeAnswer("No");
}

function probeAnswer(ans){
  const map = { "Yes": 1, "Maybe": 0, "No": -1 };
  state.probeAnswers.push(ans);
  state.probeScore += map[ans];
  log(`Probe ${state.probeIdx+1}/3 → ${ans} (${map[ans]>=0?'+':''}${map[ans]})`);
  if (state.probeIdx < 2){
    state.probeIdx += 1;
    renderProbeItem();
  } else {
    finishProbe();
  }
}

function finishProbe(){
  elAxisArea.style.display = "none";
  elAxisResult.style.display = "block";
  const S = state.probeScore;
  elAxisScore.textContent = S;
  let label = "", cls = "axisLabel";
  if (S>=3){ label="PURE+"; cls+=" pure"; }
  else if (S==2){ label="PURE"; cls+=" pure"; }
  else if (S==1){ label="WOBBLE+"; cls+=" wobble"; }
  else if (S==0){ label="WOBBLE"; cls+=" wobble"; }
  else if (S==-1){ label="OFF"; cls+=" off"; }
  else { label="OFF+"; cls+=" off"; }
  elAxisLabel.textContent = label;
  elAxisLabel.className = cls;
  const items = state.probeItems;
  const pts = state.probeAnswers.map(a=> ({ "Yes":1,"Maybe":0,"No":-1 }[a]));
  let html = "<div>";
  for (let i=0;i<items.length;i++){
    const a = state.probeAnswers[i];
    const p = pts[i];
    html += `<div style="margin:4px 0;"><span class="capsule">#${i+1} ${a} (${p>=0?'+':''}${p})</span> — ${items[i]}</div>`;
  }
  html += "</div>";
  elAxisLedger.innerHTML = html;
  state.mode = "done";
  log(`Probe finished → ${label} (S=${S})`);
}

function finalize(reason){
  state.mode = "done";
  elQline.innerHTML = `Run complete. ${reason}`;
  elOptions.querySelectorAll("button").forEach(b=>b.setAttribute("disabled","true"));
  log(`FINALIZE → ${reason}`);
}

// =========================
// Events
// =========================
btnStart.addEventListener("click", start);
btnReset.addEventListener("click", reset);

// Init
updateHeader(); updateScore();
log("Ready.");
})();</script>
</body>
</html>
